<!-- include the partial at the top of the file-->
<%- include('../partials/head')%>
<%- include('../partials/navbar')%>
<%- include('../partials/videoBG')%>

<script language="javascript">
    function passwordChanged() { //Password strength meter, notifies the user about how good their password is
        var strength = document.getElementById('strength');
        var strongRegex = new RegExp("^(?=.{14,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$", "g");
        var mediumRegex = new RegExp("^(?=.{10,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$", "g");
        var enoughRegex = new RegExp("(?=.{8,}).*", "g");
        var pwd = document.getElementById("password_new");
        if (pwd.value.length == 0) {
            strength.innerHTML = 'Type Password';
        } else if (false == enoughRegex.test(pwd.value)) {
            strength.innerHTML = 'More Characters (At least 8)';
        } else if (strongRegex.test(pwd.value)) {
            strength.innerHTML = '<span style="color:green">Strong!</span>';
        } else if (mediumRegex.test(pwd.value)) {
            strength.innerHTML = '<span style="color:orange">Medium! (Add symbols, capitals, numbers)</span>';
        } else {
            strength.innerHTML = '<span style="color:red">Weak! (Add symbols, capitals, numbers)</span>';
        }
    }
</script>

<div class="container bg-light main-bg d-flex align-items-center overflow-auto">
    <div class="container">
        <%- include('../partials/flash') %>
        <h1>Change Password</h1>
        <form action="/changePassword" method="POST" class="needs-validation" name="changePassword" novalidate>
            <input class="form-control" value="<%=currentUser.username%>" type="hidden" id="username" name="username"> <!-- Hidden input containing the users username (email) -->
            <div class="form-group">
                <label class='form-label' for="password">Old Password: </label> <!-- User must enter their old password to verify the change -->
                <input type="password"  id="password" placeholder="Old Password" name="password" class="form-control" required>
            </div>
            <div class="form-group">
                <label class='form-label' for="password_new">Password: </label> <!-- New password that the user wants.  On each key up the password strength meter is updated.  New password must be at least 8 characters in length -->
                <input type="password" pattern=".{8,}" id="password_new" placeholder="New Password" name="password_new" class="form-control" onkeyup="return passwordChanged();" required>
                <span id="strength">Type Password</span>
            </div>
            <div class="form-group">
                <label class='form-label' for="password_new_verify">Re-Enter Password: </label> <!-- User re-types in their password so it makes sure they entered it correctly -->
                <input type="password" pattern=".{8,}" id="password_new_verify" placeholder="Re-type New Password" name="password_new_verify" class="form-control" required>
            </div>
            <div class="form-group">
                <div class="col-sm-3"></div>
                <div class="col-sm">
                    <button type="submit" class="btn btn-outline-primary btn-block">Change Password</button>
                </div>
                <div class="col-sm-3"></div>
            </div>
        </form>
